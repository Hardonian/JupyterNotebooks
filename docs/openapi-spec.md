# OpenAPI Specification

**Last Updated:** 2024-01-XX  
**Purpose:** Guide for accessing and using the OpenAPI specification

---

## Overview

Agent Factory provides an OpenAPI 3.0 specification that documents all API endpoints, request/response schemas, and authentication requirements.

---

## Accessing the OpenAPI Spec

### Interactive Documentation (Swagger UI)

**URL:** `http://localhost:8000/docs` (development)  
**URL:** `https://api.agentfactory.io/docs` (production)

Features:
- Interactive API explorer
- Try-it-out functionality
- Request/response examples
- Schema documentation

### ReDoc Documentation

**URL:** `http://localhost:8000/redoc` (development)  
**URL:** `https://api.agentfactory.io/redoc` (production)

Features:
- Clean, readable documentation
- Search functionality
- Schema details

### JSON Schema

**URL:** `http://localhost:8000/openapi.json` (development)  
**URL:** `https://api.agentfactory.io/openapi.json` (production)

Returns: Complete OpenAPI 3.0 JSON specification

---

## Generating OpenAPI Spec

### Automatic Generation

The OpenAPI spec is automatically generated by FastAPI from:
- Route definitions (`@router.get`, `@router.post`, etc.)
- Pydantic models (request/response schemas)
- Route docstrings (descriptions)

### Manual Generation

```python
from agent_factory.api.main import app
import json

# Get OpenAPI spec
openapi_schema = app.openapi()

# Save to file
with open("openapi.json", "w") as f:
    json.dump(openapi_schema, f, indent=2)
```

### Command Line

```bash
# Start server and fetch spec
uvicorn agent_factory.api.main:app &
sleep 2
curl http://localhost:8000/openapi.json > openapi.json
```

---

## Using the OpenAPI Spec

### Code Generation

Generate client SDKs using OpenAPI Generator:

```bash
# Install OpenAPI Generator
npm install -g @openapi-generator/cli

# Generate Python client
openapi-generator generate \
  -i openapi.json \
  -g python \
  -o ./generated-client

# Generate TypeScript client
openapi-generator generate \
  -i openapi.json \
  -g typescript-axios \
  -o ./generated-client
```

### API Testing

Use tools like Postman or Insomnia:
1. Import `openapi.json`
2. Generate collection
3. Test endpoints

### Documentation

Use tools like Redoc or Swagger UI:
1. Host `openapi.json`
2. Point documentation tool to spec
3. Generate documentation site

---

## OpenAPI Spec Structure

### Info Section

```json
{
  "openapi": "3.0.0",
  "info": {
    "title": "Agent Factory Platform API",
    "version": "0.1.0",
    "description": "REST API for building and running AI agents"
  }
}
```

### Paths Section

Documents all API endpoints:
- `/api/v1/agents`
- `/api/v1/workflows`
- `/api/v1/blueprints`
- `/api/v1/executions`
- etc.

### Components Section

Documents reusable schemas:
- Request models
- Response models
- Security schemes

---

## Endpoint Documentation

### Example: Create Agent

```yaml
post:
  summary: Create a new agent
  operationId: create_agent
  tags:
    - agents
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/AgentCreate'
  responses:
    '200':
      description: Agent created
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AgentResponse'
```

### Example: Run Agent

```yaml
post:
  summary: Run an agent
  operationId: run_agent
  tags:
    - agents
  parameters:
    - name: agent_id
      in: path
      required: true
      schema:
        type: string
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/AgentRun'
  responses:
    '200':
      description: Agent execution result
```

---

## Authentication

### API Key Authentication

```yaml
securitySchemes:
  ApiKeyAuth:
    type: apiKey
    in: header
    name: X-API-Key
  BearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
```

### Usage

```yaml
paths:
  /api/v1/agents:
    get:
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
```

---

## Schema Examples

### AgentCreate

```json
{
  "type": "object",
  "required": ["id", "name", "instructions"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique agent identifier"
    },
    "name": {
      "type": "string",
      "description": "Agent name"
    },
    "instructions": {
      "type": "string",
      "description": "Agent instructions/prompt"
    },
    "model": {
      "type": "string",
      "default": "gpt-4o",
      "description": "LLM model to use"
    }
  }
}
```

---

## Validation

### Validate OpenAPI Spec

```bash
# Install validator
npm install -g swagger-cli

# Validate spec
swagger-cli validate openapi.json
```

### Online Validator

- https://editor.swagger.io/
- Upload `openapi.json`
- Check for errors

---

## Versioning

### API Versioning

Current version: `v1`

Version in path: `/api/v1/...`

### Spec Versioning

OpenAPI version: `3.0.0`

API version: `0.1.0` (in info.version)

---

## Best Practices

1. **Keep spec up to date** - Update when adding/modifying endpoints
2. **Use Pydantic models** - Auto-generate schemas from models
3. **Add descriptions** - Document all endpoints and schemas
4. **Include examples** - Provide request/response examples
5. **Validate spec** - Use validators before publishing

---

## Troubleshooting

### Spec Not Updating

- Restart FastAPI server
- Clear browser cache
- Check route definitions

### Missing Endpoints

- Verify routes are included in `app.include_router()`
- Check route decorators are correct
- Ensure Pydantic models are used

### Schema Errors

- Validate Pydantic models
- Check model field types
- Verify required fields

---

**Last Updated:** 2024-01-XX  
**Maintained By:** Unified Background Agent v3.0
